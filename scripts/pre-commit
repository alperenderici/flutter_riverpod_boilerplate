#!/bin/bash

# Pre-commit hook for Flutter Riverpod Boilerplate
# This script runs before each commit to ensure code quality

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if Flutter is available
if ! command -v flutter &> /dev/null; then
    echo "âŒ Flutter is not installed or not in PATH"
    exit 1
fi

# Check if we're in a Flutter project
if [ ! -f "pubspec.yaml" ]; then
    echo "âŒ Not in a Flutter project directory"
    exit 1
fi

# Get dependencies
echo "ğŸ“¦ Getting dependencies..."
flutter pub get

# Run code generation if needed
if [ -d "lib" ] && grep -r "@freezed\|@riverpod\|@JsonSerializable" lib/ > /dev/null 2>&1; then
    echo "ğŸ”§ Running code generation..."
    flutter packages pub run build_runner build --delete-conflicting-outputs
fi

# Format code
echo "ğŸ¨ Formatting code..."
dart format lib/ test/ --set-exit-if-changed

# Analyze code
echo "ğŸ” Analyzing code..."
flutter analyze

# Run tests
echo "ğŸ§ª Running tests..."
flutter test

echo "âœ… All pre-commit checks passed!"
